<%- algolia_search() %>
<%- algolia_search_config() %>

<div id="search" class="container">

    <div class="card shadow rounded flex-row border-0 mt-3 d-flex justify-content-center" style="width:100%; height:60px;">
        <form class="form-inline">
            <b-form-input v-model="keyword" class="mr-2"></b-form-input>
            <b-button @click="search(page_number)" :disabled="loading">搜索</b-button>
        </form>
    </div>

    <b-card v-for="(result, index) of results" :key="index" class="mt-3 shadow border-0">

        <h4 class="card-title text-truncate" :title="result.title">
            <a :href="result.permalink" class="text-dark text-decoration-none" target="_blank">
                {{ result.title }}
            </a>
        </h4>
        <span class="text-secondary">{{ dayjs(result.date).format('YYYY-M-D') }}</span>

    </b-card>

    <div class="mt-3" v-if="results.length">
        <b-pagination :align="'center'" v-model="page_number" :total-rows="total" :per-page="page_size" @change="search" last-number></b-pagination>
    </div>
    
</div>


<script>
    new Vue({
        el: 'div#search',
        data: {
            keyword: '',
            page_number:1,
            page_size:5,
            total:0,
            loading:false,
            results: []
        },
        methods: {
            async search(page) {
                const algoliaConfig = document.querySelector('meta[property="algolia:search"]').dataset;

                const client = algoliasearch(algoliaConfig.applicationId, algoliaConfig.apiKey)
                const index = client.initIndex(algoliaConfig.indexName)

                NProgress.start()
                this.loading = true

                index.search(this.keyword, {
                    page: page - 1,
                    hitsPerPage: this.page_size,
                })
                .then(result => {
                    this.results = result.hits;
                    this.total = result.nbHits;
                    
                    NProgress.done()
                    this.loading = false
                })

            }
        },
        mounted() {         
        }
    })
</script>